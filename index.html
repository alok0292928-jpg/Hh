<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOBITA PRO USER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* --- CORE STYLES --- */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: #050505; color: white; font-family: 'Rajdhani', sans-serif;
            margin: 0; display: flex; justify-content: center; min-height: 100vh; overflow: hidden;
            background-image: linear-gradient(rgba(0, 255, 65, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 65, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .app-container {
            width: 100%; max-width: 450px; height: 100vh; display: flex; flex-direction: column;
            position: relative; background: rgba(0,0,0,0.9); border: 1px solid #111;
        }

        /* LAYERS (Login, App, Maintenance) */
        .layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #000; }
        .hidden { display: none !important; }

        /* HEADER */
        .header { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #00ff41; background: #0a0a0a; }
        .brand { font-family: 'Orbitron'; font-weight: 900; font-size: 20px; }
        
        /* PLAN BADGE (Dynamic) */
        .plan-badge { padding: 4px 10px; border-radius: 5px; font-size: 10px; font-weight: bold; font-family: 'Orbitron'; text-transform: uppercase; }
        .badge-silver { background: #333; color: #fff; border: 1px solid #aaa; }
        .badge-gold { background: rgba(255, 215, 0, 0.2); color: #ffd700; border: 1px solid #ffd700; }
        .badge-diamond { background: rgba(0, 229, 255, 0.2); color: #00e5ff; border: 1px solid #00e5ff; }

        /* CONTENT */
        .content { flex: 1; padding: 20px; overflow-y: auto; text-align: center; }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }

        /* INPUT AREA */
        .input-card { background: #111; border: 1px solid #333; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .game-input { background: #000; border: 2px solid #00ff41; color: #fff; font-family: 'Orbitron'; font-size: 30px; width: 120px; text-align: center; border-radius: 10px; padding: 10px; outline: none; }
        
        /* CIRCLE PREDICTION */
        .circle-container { display: flex; justify-content: center; margin: 20px 0; }
        .prediction-circle { width: 200px; height: 200px; border-radius: 50%; border: 4px solid #222; display: flex; flex-direction: column; justify-content: center; align-items: center; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .pred-text { font-family: 'Orbitron'; font-weight: 900; font-size: 45px; opacity: 0; }
        .scanning { animation: shake 0.2s infinite; color: #aaa; font-size: 20px; opacity: 1; }
        
        /* ANIMATIONS */
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        .animate-result { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .green-glow { color: #00ff41; text-shadow: 0 0 30px #00ff41; }
        .red-glow { color: #ff003c; text-shadow: 0 0 30px #ff003c; }

        /* NUMBERS */
        .number-box { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .num-block { width: 50px; height: 50px; border: 1px solid #333; background: #0a0a0a; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-family: 'Orbitron'; font-size: 20px; font-weight: bold; color: #aaa; }
        .num-active { border-color: #00e5ff; color: #00e5ff; text-shadow: 0 0 10px #00e5ff; animation: popIn 0.6s ease forwards; }

        /* BUTTONS */
        .action-btn { width: 100%; padding: 15px; margin-top: 10px; background: #00ff41; border: none; color: #000; font-family: 'Orbitron'; font-size: 16px; font-weight: bold; border-radius: 5px; cursor: pointer; }
        
        /* HISTORY */
        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
        .history-header th { padding: 10px; background: #111; color: #888; border-bottom: 2px solid #333; }
        .history-row td { padding: 15px 5px; text-align: center; border-bottom: 1px solid #222; }
        .status-btn { padding: 2px 8px; border: 1px solid #333; background: black; color: #aaa; font-size: 10px; cursor: pointer; }
        .status-btn.win { border-color: #00ff41; color: #00ff41; }
        .status-btn.loss { border-color: red; color: red; }

        /* NAVBAR */
        .navbar { position: absolute; bottom: 20px; left: 20px; right: 20px; height: 60px; background: #111; border: 1px solid #333; border-radius: 30px; display: flex; justify-content: space-around; align-items: center; }
        .nav-item { color: #555; font-size: 20px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: #00ff41; text-shadow: 0 0 10px #00ff41; }

        /* MAINTENANCE */
        .maint-icon { font-size: 50px; color: red; margin-bottom: 20px; }
        .maint-text { font-family: 'Orbitron'; font-size: 24px; color: white; margin-bottom: 10px; }
        .maint-sub { color: #888; font-size: 12px; text-align: center; }

        /* LOGIN INPUTS */
        .login-input { background: #111; border: 1px solid #333; padding: 15px; width: 80%; color: white; text-align: center; font-family: 'Orbitron'; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="maintenanceLayer" class="layer hidden" style="z-index: 999; background: #050505;">
        <div class="maint-icon">‚ö†Ô∏è</div>
        <div class="maint-text">MAINTENANCE</div>
        <div class="maint-sub">SERVER UNDER UPGRADE.<br>PLEASE WAIT FOR ADMIN UPDATE.</div>
    </div>

    <div id="loginLayer" class="layer">
        <h2 style="font-family:'Orbitron'; color:#00ff41; margin-bottom: 30px;">NOBITA SECURITY</h2>
        <input type="text" id="keyInput" class="login-input" placeholder="ENTER VIP KEY">
        <button class="action-btn" style="width: 80%;" onclick="login()">CONNECT</button>
        <p id="loginStatus" style="color:red; font-size:12px; margin-top:10px;"></p>
    </div>

    <div id="appLayer" class="app-container hidden">
        
        <div class="header">
            <div>
                <div class="brand">NOBITA AI</div>
                <div id="userBadge" class="plan-badge">LOADING...</div>
            </div>
            <button onclick="logout()" style="background:none; border:none; color:red; font-size:10px;">LOGOUT</button>
        </div>

        <div id="tab-home" class="content tab-content active">
            <div class="input-card">
                <input type="tel" id="lastInput" class="game-input" maxlength="1" placeholder="?">
                <button class="action-btn" onclick="runAnalysis()">SCAN NOW</button>
            </div>

            <div class="circle-container">
                <div class="prediction-circle" id="mainCircle">
                    <div style="font-size:10px; color:#aaa;">RESULT</div>
                    <div id="predText" class="pred-text">--</div>
                    <div id="predInfo" style="font-size:10px; color:#00e5ff; margin-top:5px; opacity:0;">CONFIDENCE: 99%</div>
                </div>
            </div>

            <div id="numbersContainer" class="number-box hidden">
                <div class="num-block" id="n1">-</div>
                <div class="num-block" id="n2">-</div>
                <div class="num-block" id="n3">-</div>
            </div>
        </div>

        <div id="tab-history" class="content tab-content">
            <div style="font-family:'Orbitron'; font-size:16px; margin-bottom:10px;">SESSION HISTORY</div>
            <table class="history-table">
                <thead class="history-header"><tr><th>LAST</th><th>PRED</th><th>RESULT</th></tr></thead>
                <tbody id="historyList"></tbody>
            </table>
        </div>

        <div class="navbar">
            <div class="nav-item active" onclick="switchTab('home', this)">‚ö°</div>
            <div class="nav-item" onclick="switchTab('history', this)">üìú</div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get, update, child, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDXlyYirIWVN-geJclEXIV408hC5jwB4fg",
        authDomain: "v110-25f09.firebaseapp.com",
        databaseURL: "https://v110-25f09-default-rtdb.firebaseio.com",
        projectId: "v110-25f09",
        storageBucket: "v110-25f09.firebasestorage.app",
        messagingSenderId: "971519760374",
        appId: "1:971519760374:web:e59863fa4d05a22f1c59d7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- SYSTEM VARIABLES ---
    let systemLogic = { mode: "normal", gold_win: 80, diamond_win: 95 }; // Default
    let userPlan = "silver"; // Default

    // --- 1. LISTEN FOR MAINTENANCE & LOGIC UPDATE ---
    onValue(ref(db, 'system_config'), (snap) => {
        if(snap.exists()) {
            const config = snap.val();
            
            // Check Maintenance
            if(config.maintenance === true) {
                document.getElementById('maintenanceLayer').classList.remove('hidden');
            } else {
                document.getElementById('maintenanceLayer').classList.add('hidden');
            }

            // Update Logic silently
            systemLogic = config;
            console.log("System Updated:", systemLogic);
        }
    });

    // --- 2. LOGIN SYSTEM ---
    window.login = async () => {
        const key = document.getElementById('keyInput').value.trim();
        const status = document.getElementById('loginStatus');
        const deviceId = localStorage.getItem('nobita_did') || 'dev_' + Date.now();
        localStorage.setItem('nobita_did', deviceId);

        if(!key) { status.innerText = "Enter Key"; return; }
        status.innerText = "Verifying...";

        try {
            const snap = await get(child(ref(db), `access_keys/${key}`));
            if(snap.exists()) {
                const data = snap.val();
                const now = Date.now();

                // Validation
                if(data.expiry < now) { status.innerText = "Key Expired!"; return; }
                if(data.deviceId && data.deviceId !== deviceId) { status.innerText = "Locked to another device!"; return; }
                
                // First Time Lock
                if(!data.deviceId) await update(ref(db, `access_keys/${key}`), { deviceId: deviceId });

                // Save Session
                localStorage.setItem('nobita_key', key);
                localStorage.setItem('nobita_plan', data.plan); // SAVE PLAN FROM DB
                
                startApp(data.plan);
            } else {
                status.innerText = "Invalid Key";
            }
        } catch(e) {
            status.innerText = "Network Error";
        }
    };

    // --- 3. START APP UI ---
    function startApp(plan) {
        userPlan = plan || 'silver'; // Set Global Plan Variable
        
        document.getElementById('loginLayer').classList.add('hidden');
        document.getElementById('appLayer').classList.remove('hidden');

        // Update Badge
        const badge = document.getElementById('userBadge');
        badge.innerText = userPlan.toUpperCase() + " USER";
        badge.className = `plan-badge badge-${userPlan}`;

        // Show/Hide Numbers based on Plan
        if(userPlan === 'silver') {
            document.getElementById('numbersContainer').classList.add('hidden');
        } else {
            document.getElementById('numbersContainer').classList.remove('hidden');
        }
    }

    // --- 4. PREDICTION LOGIC (CONTROLLED BY SYSTEM LOGIC) ---
    window.runAnalysis = () => {
        const input = document.getElementById('lastInput').value;
        if(!input) return;

        const predText = document.getElementById('predText');
        const predInfo = document.getElementById('predInfo');

        // Reset UI
        predText.classList.remove('animate-result', 'green-glow', 'red-glow');
        predText.classList.add('scanning');
        predText.innerText = "SCAN";
        predInfo.style.opacity = 0;
        
        // Hide numbers initially
        document.querySelectorAll('.num-block').forEach(b => {
            b.innerText = "-";
            b.classList.remove('num-active');
        });

        setTimeout(() => {
            // LOGIC CORE
            let result = Math.random() > 0.5 ? "BIG" : "SMALL";
            
            // Apply System Logic Injection (Fake implementation of win rate)
            // If system mode is aggressive, maybe flip result randomly
            if(systemLogic.mode === 'aggressive' && Math.random() > 0.7) {
                result = result === "BIG" ? "SMALL" : "BIG";
            }

            // Display Result
            predText.classList.remove('scanning');
            void predText.offsetWidth; // Trigger Reflow
            predText.innerText = result;
            predText.classList.add('animate-result', result === "BIG" ? "green-glow" : "red-glow");
            predInfo.style.opacity = 1;

            // HANDLE NUMBERS (GOLD/DIAMOND ONLY)
            if(userPlan !== 'silver') {
                let nums = [];
                if(userPlan === 'gold') {
                    // Gold = Opposite (Cover)
                    nums = result === "BIG" ? [0,2,4] : [5,7,9];
                } else {
                    // Diamond = Direct
                    nums = result === "BIG" ? [6,8,9] : [1,3,4];
                }
                
                // Shuffle
                nums.sort(() => Math.random() - 0.5);
                
                setTimeout(() => {
                    document.getElementById('n1').innerText = nums[0];
                    document.getElementById('n2').innerText = nums[1];
                    document.getElementById('n3').innerText = nums[2];
                    document.querySelectorAll('.num-block').forEach(b => b.classList.add('num-active'));
                }, 300);
            }

            // Add History
            addHistory(input, result);

        }, 1500);
    };

    function addHistory(last, pred) {
        const list = document.getElementById('historyList');
        const row = document.createElement('tr');
        row.className = 'history-row';
        row.innerHTML = `
            <td>${last}</td>
            <td style="color:${pred==='BIG'?'#00ff41':'red'}; font-weight:bold;">${pred}</td>
            <td>
                <button class="status-btn win" onclick="this.style.background='green'; this.style.color='black'">W</button>
                <button class="status-btn loss" onclick="this.style.background='red'; this.style.color='white'">L</button>
            </td>
        `;
        list.prepend(row);
    }

    // --- UTILS ---
    window.switchTab = (id, el) => {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    };

    window.logout = () => {
        localStorage.removeItem('nobita_key');
        localStorage.removeItem('nobita_plan');
        location.reload();
    };

    // Auto Login Check
    if(localStorage.getItem('nobita_key')) {
        // We verify again to check if plan changed or expired
        window.login(); 
    }

</script>
</body>
</html>
